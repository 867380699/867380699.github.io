---

layout: post
title: "Git笔记"
date: 2018-04-09

---

# 设置Git服务器
## 配置用户
```bash
$ sudo adduser git
$ su git
$ cd
$ mkdir .ssh && chmod 700 .ssh
$ touch .ssh/authorized_keys && chmod 600 .ssh/authorized_keys
```
## 添加 authorized_keys
在自己的机器上获取公钥
```bash
$ cat ~/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCB007n/ww+ouN4gSLKssMxXnBOvf9LGt4L
ojG6rs6hPB09j9R/T17/x4lhJA0F3FR1rP6kYBRsWj2aThGw6HXLm9/5zytK6Ztg3RPKK+4k
Yjh6541NYsnEAZuXz0jTTyAUfrtU3Z5E003C4oxOj6H0rfIF1kKI9MAQLMdpGW1GYEIgS9Ez
Sdfd8AcCIicTDWbqLAcU4UpkaX8KyGlLwsNuuGztobF8m72ALC/nLF6JLtPofwFBlgc+myiv
O7TCUSBdLQlgMVOFq1I2uPWQOkOWQAHukEOmfjy2jctxSDBQ220ymjaNsHT4kgtZg2AYYgPq
dAv8JggJICUvax2T9va5 gsg-keypair
```
将输出复制到服务器上的 `.ssh/authorized_keys` 文件中。

## 创建仓库
```bash
$ cd /home/git
$ mkdir project.git
$ cd project.git
$ git init --bare
```
## 提交代码
```bash
$ cd myproject
$ git init
$ git add .
$ git commit -m 'initial commit'
$ git remote add origin git@gitserver:/home/git/project.git
$ git push origin master
```

## 其他

命令行中不显示中文文件名

```bash
git config --global core.quotepath false
```

查看最后修改

```bash
git blame
```

如果有文件漏提交了，可以这么操作

```bash
git add 要提交的文件
git commit -m "新的message" --amend
```

```bash
# 添加一个tag
git tag -a "tag-name" <ref> -m "message"
# 删除一个tag
git tag -d <tag-name>
#重命名一个tag
git tag "new-tag-name" <old-tag-ref>
git tag -d <old-tag-ref>
# 推送tag
git push —tags
# 回到一个tag版本
git checkout <tag>
```

```bash
# 合并一个指定的commit
git cherry-pick <commit hash>
```

```bash
# 删除untracked的数据
# -n dry run - 演习
# -f force - 强制删除，默认不加-f会警告且不删除
# -d directory - 同时删除目录，默认不删除目录
git clean
```

```bash
# 显示代码增删信息
git log --stat
# 显示指定路径的具体更改
git log --full-diff -p <path>
```

```bash
# 显示配置
git config -l
# 配置
git config user.naem "username"
```
## Git 的一些符号
`@` 是 `HEAD` 的别名。
`~` 和 `^` 的意义相同。

## 参考资料
[服务器设置 - git-scm.com](https://git-scm.com/book/en/v2/Git-on-the-Server-Setting-Up-the-Server)

# Tips
## 还原
```
git checkout -- <path>
git reset HEAD <path>
git clean -df
```
## 符号
`@` is an alias for `HEAD`. And since `~` and `^` are the same.

## 比较
```bash
# 比较 working tree 和 staged 的不同
git diff 
# 比较暂存区和本地仓库的不同
git diff --cached
# 比较本地仓库和远端仓库的不同
git diff master origin/master
# 具体修改
git diff -p <path>
```

## Alias
```bash
git config --global alias.st status
git config --global alias.co checkout
git config --global alias.br branch
```

## 支持 utf-8
```
git config --global core.quotepath false  
```

## 提交

```bash
# push 本地的 dev 到远端的 test
git push upstream dev:test
```

## pull vs fetch
`git pull` does a `git fetch` followed by a `git merge`.

```bash
# Merge remote branch origin/foo into local branch foo,
# without having to checkout foo first:
git fetch origin foo:foo
```